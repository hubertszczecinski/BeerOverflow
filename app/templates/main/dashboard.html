{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="dashboard-card">
                <h2>Welcome, {{ user.first_name or user.username }}!</h2>
                <p class="mb-0">Manage Your Bank Account</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="product-card text-center">
                <div class="card-icon"><i class="fas fa-exchange-alt"></i></div>
                <h4>Transfer</h4>
                <a href="{{ url_for('main.transfer') }}" class="btn btn-primary btn-sm w-100 transfer-link">Transfer Now</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="product-card text-center">
                <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                <h4>Portfolio</h4>
                <a href="#" class="btn btn-primary btn-sm w-100">Go to Portfolio</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="product-card text-center">
                <div class="card-icon"><i class="fas fa-home"></i></div>
                <h4>Mortgage Loan Application</h4>
                <a href="{{ url_for('main.mortgage_application') }}" class="btn btn-primary btn-sm w-100">Apply Now</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="product-card text-center">
                <div class="card-icon"><i class="fas fa-file-invoice"></i></div>
                <h4>Statements</h4>
                <a href="{{ url_for('main.statements') }}" class="btn btn-primary btn-sm w-100 statements-link">View</a>
            </div>
        </div>
    </div>
    
    <!-- Account Information -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Account Information</h5>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th style="width: 200px;">Username:</th>
                            <td>{{ user.username }}</td>
                        </tr>
                        <tr>
                            <th>Email:</th>
                            <td>{{ user.email }}</td>
                        </tr>
                        <tr>
                            <th>Name:</th>
                            <td>{{ user.first_name }} {{ user.last_name }}</td>
                        </tr>
                        <tr>
                            <th>Member Since:</th>
                            <td>{{ user.created_at.strftime('%d.%m.%Y') if user.created_at else 'N/A' }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Account Balance</h5>
                </div>
                <div class="card-body text-center">
                    <h2 class="text-primary mb-3">10,000.00 €</h2>
                    <p class="text-muted">Current Account</p>
                    <a href="#" class="btn btn-outline-primary w-100">View Details</a>
                </div>
            </div>
        </div>
    </div>
	
		<!-- Voice Navigation Floating Window -->
	<div id="voice-control-window" class="voice-control-window">
		<div class="voice-control-header">
			<h6>Voice Navigation</h6>
			<button id="voice-control-close" class="btn-close btn-close-sm"></button>
		</div>
		<div class="voice-control-body">
			<button id="voice-record-btn" class="btn btn-primary btn-sm w-100">
				<i class="fas fa-microphone"></i> Start Recording
			</button>
			<div id="voice-status" class="voice-status mt-2"></div>
			<div id="voice-commands" class="voice-commands mt-3">
				<small class="text-muted">Try saying:</small>
				<ul class="list-unstyled mt-1">
					<li><small>"Go to transfer"</small></li>
					<li><small>"Show statements"</small></li>
					<li><small>"Apply for mortgage"</small></li>
					<li><small>"Go to dashboard"</small></li>
				</ul>
			</div>
		</div>
	</div>

	<!-- Voice Control Toggle Button -->
	<button id="voice-control-toggle" class="voice-control-toggle">
		<i class="fas fa-microphone"></i>
	</button>
	
</div>

<!-- Face ID Overlay -->
<div id="faceid-overlay">
  <div id="faceid-circle" class="faceid-circle">
    <img src="{{ url_for('static', filename='images/face_id_logo.png') }}" alt="Face ID">
    <div id="faceid-tick" class="faceid-tick">✔️</div>
  </div>
  <div id="faceid-text" class="faceid-text"></div>
</div>

<script src="{{ url_for('static', filename='scripts.js') }}"></script>
<script>
  // Handle face-check for transfer and statements links
  document.addEventListener('DOMContentLoaded', function() {
    const transferLink = document.querySelector('.transfer-link');
    const statementsLink = document.querySelector('.statements-link');
    
    if (transferLink) {
      transferLink.addEventListener('click', function(e) {
        e.preventDefault();
        const targetUrl = this.getAttribute('href');
        performFaceCheck(targetUrl);
      });
    }
    
    if (statementsLink) {
      statementsLink.addEventListener('click', function(e) {
        e.preventDefault();
        const targetUrl = this.getAttribute('href');
        performFaceCheck(targetUrl);
      });
    }
  });
  
  function performFaceCheck(targetUrl) {
    showFaceID(null);
    
    fetch('{{ url_for("main.verify_face") }}')
      .then(response => response.json())
      .then(data => {
        showFaceID(data.result, data.result ? targetUrl : null);
      })
      .catch(error => {
        console.error('Error:', error);
        showFaceID(false, null);
      });
  }
</script>
{% endblock %}